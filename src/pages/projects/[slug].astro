---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import Comments from "../../components/Comments.astro"; // optional reuse

export async function getStaticPaths() {
  const projects = await getCollection('projects');
  return projects.map(({ slug }) => ({ params: { slug } }));
}

const { slug } = Astro.params;
const project = await (await import('astro:content')).getEntry('projects', slug);
const { Content } = await project.render();
const { title, date, updated, image, summary, tags, status, role, org, repo, demo } = project.data;
---

<Layout title={title} description={summary} overlapHeader={false}>
  {/* SIMPLE PROJECT IMAGE — mirrors blog styling */}
  {image && (
    <figure class="mx-auto w-full max-w-5xl px-6 mt-6">
      <img
        src={image}
        alt={title}
        class="block w-full rounded-xl border border-zinc-200 object-cover"
        loading="eager"
        decoding="async"
        fetchpriority="high"
      />
    </figure>
  )}


  <!-- Body -->
  <article class="relative mx-auto max-w-3xl px-6 pb-20 pt-10">
    <a href="/projects" class="inline-flex items-center gap-2 rounded-lg border border-zinc-200 px-3 py-1.5 text-sm text-zinc-700 hover:bg-white/60">
      ← Back to Projects
    </a>

    <header class="mt-6 mb-6">
      <h1 class="text-4xl font-bold tracking-tight text-zinc-900">{title}</h1>
      <div class="mt-2 flex flex-wrap items-center gap-3 text-[0.92rem] text-zinc-500">
        <time>{date.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' })}</time>
        {updated && <span>• Updated {updated.toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' })}</span>}
        {status && <span class="rounded-full bg-zinc-100 px-2 py-0.5 text-xs text-zinc-600 ring-1 ring-zinc-200">{status}</span>}
        {org && <span class="rounded-full bg-zinc-50 px-2 py-0.5 text-xs text-zinc-600 ring-1 ring-zinc-200">{org}</span>}
        {role && <span class="rounded-full bg-zinc-50 px-2 py-0.5 text-xs text-zinc-600 ring-1 ring-zinc-200">{role}</span>}
      </div>
      {(repo || demo) && (
        <div class="mt-3 flex flex-wrap gap-3">
          {demo && <a href={demo} class="rounded-lg bg-teal-600 px-3 py-1.5 text-sm font-medium text-white hover:bg-teal-700">Live demo</a>}
          {repo && <a href={repo} class="rounded-lg bg-zinc-900 px-3 py-1.5 text-sm font-medium text-white hover:bg-zinc-800">Repository</a>}
        </div>
      )}
    </header>

    {tags?.length ? (
      <div class="mb-6 flex flex-wrap gap-2">
        {tags.map((t: string) => (
          <a href={`/projects?${new URLSearchParams({ tag: t })}`}
             class="rounded-full border border-zinc-200 bg-white px-3 py-1 text-xs font-medium text-zinc-700 shadow-sm">
            {t}
          </a>
        ))}
      </div>
    ) : null}

    <div class="prose prose-zinc max-w-none">
      <Content />
    </div>

    <div class="mt-12">
      <Comments
        repo="anuj-nk/anuj-nk.github.io"
        repoId="R_kgDOO-p9mA"
        category="Comments"
        categoryId="DIC_kwDOO-p9mM4Cv-pc"
        mapping="pathname"
      />
    </div>
  </article>
</Layout>
